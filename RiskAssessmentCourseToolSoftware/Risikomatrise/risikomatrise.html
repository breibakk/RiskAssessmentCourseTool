


<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risikomatrise</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }
    table {
        border-collapse: collapse;
        margin-bottom: 20px;      
    }
    th, td {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: left;
        min-width: 100px;
    }
    th {
        background-color: #f2f2f2;
    }
    .highlight {
        font-weight: bold;         /* Bold text */
    }
    .green { background-color: #a8d08d; }
    .yellow { background-color: #ffff00; }
    .red { background-color: #ff0000; }
    button {
        margin-right: 10px;
    }
    .resizer {
        display: inline-block;
        width: 10px;
        height: 100%;
        cursor: col-resize;
        position: absolute;
        right: 0;
        top: 0;
        transform: translateX(50%);
    }
    tr.selected {
        background-color: #d0eaff;
    }
    </style>
</head>
<body>

    <h2>Konsekvensskala</h2>
    <table id="consequenceScale">
        <thead>
            <tr>
                <th>Verdi<div class="resizer"></div></th>
                <th>Beskrivelse<div class="resizer"></div></th>
            </tr>
        </thead>
        <tbody>
            <!-- Initial 5 rows -->
            <tr><td contenteditable="false" class="highlight">Svært høy</td><td contenteditable="false">Vesentlig økonomisk tap; konkurs eller oppsigelser truer</td></tr>
            <tr><td contenteditable="false" class="highlight">Høy</td><td contenteditable="false">Stort økonomisk tap, forutsetter ingen vesentlig kursendring</td></tr>
            <tr><td contenteditable="false" class="highlight">Moderat</td><td contenteditable="false">Økonomisk tap som helst skulle vært unngått</td></tr>
            <tr><td contenteditable="false" class="highlight">Lav</td><td contenteditable="false">Et lite økonomisk tap eller små skader</td></tr>
            <tr><td contenteditable="false" class="highlight">Svært lav</td><td contenteditable="false">Kun minimale tap eller skader; ingen betydning for driften</td></tr>
        </tbody>
    </table>

<button onclick="loadConsequences()">Last inn egendefinerte konsekvenser</button>

    <h2>Hyppighetsskala</h2>
    <table id="frequencyScale">
        <thead>
            <tr>
                <th>Verdi<div class="resizer"></div></th>
                <th>Beskrivelse<div class="resizer"></div></th>
            </tr>
        </thead>
        <tbody>
            <!-- Initial 5 rows -->
            <tr><td contenteditable="false" class="highlight">Svært høy</td><td contenteditable="false">Et svært høyt antall tilsvarende hendelser allerede registrert; forekommer daglig på samme sted, i
samme situasjon eller til samme tid</td></tr>
            <tr><td contenteditable="false" class="highlight">Høy</td><td contenteditable="false">Et høyt antall tilsvarende hendelser allerede registrert; forekommer ukentlig på samme sted, i samme
situasjon eller til samme tid</td></tr>
            <tr><td contenteditable="false" class="highlight">Moderat</td><td contenteditable="false">Mange tilsvarende hendelser allerede registrert</td></tr>
            <tr><td contenteditable="false" class="highlight">Lav</td><td contenteditable="false">Kun et fåtall tilsvarende hendelser registrert; forkommer sjelden på samme sted, i samme situasjon
eller til samme tid</td></tr>
            <tr><td contenteditable="false" class="highlight">Svært lav</td><td contenteditable="false">Har ikke forekommet til dags dato; anses som usannsynlig</td></tr>
        </tbody>
    </table>

<button onclick="loadFrequencies()">Last inn egendefinerte hyppigheter</button>

    <h2>Risikomatrise</h2>
    <table id="riskMatrix">
        <thead>
            <tr>
                <th rowspan="2">Konsekvens</th>
                <th colspan="5">Hyppighet</th>
            </tr>
            <tr>
                <td class="highlight">Svært lav</td>
                <td class="highlight">Lav</td>
                <td class="highlight">Moderat</td>
                <td class="highlight">Høy</td>
                <td class="highlight">Svært høy</td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="highlight">Svært høy</td>
                <td class="yellow" data-consequence="Svært høy" data-frequency="Svært lav"></td>
                <td class="red" data-consequence="Svært høy" data-frequency="Lav"></td>
                <td class="red" data-consequence="Svært høy" data-frequency="Moderat"></td>
                <td class="red" data-consequence="Svært høy" data-frequency="Høy"></td>
                <td class="red" data-consequence="Svært høy" data-frequency="Svært høy"></td>
            </tr>
            <tr>
                <td class="highlight">Høy</td>
                <td class="green" data-consequence="Høy" data-frequency="Svært lav"></td>
                <td class="yellow" data-consequence="Høy" data-frequency="Lav"></td>
                <td class="red" data-consequence="Høy" data-frequency="Moderat"></td>
                <td class="red" data-consequence="Høy" data-frequency="Høy"></td>
                <td class="red" data-consequence="Høy" data-frequency="Svært høy"></td>
            </tr>
            <tr>
                <td class="highlight">Moderat</td>
                <td class="green" data-consequence="Moderat" data-frequency="Svært lav"></td>
                <td class="green" data-consequence="Moderat" data-frequency="Lav"></td>
                <td class="yellow" data-consequence="Moderat" data-frequency="Moderat"></td>
                <td class="red" data-consequence="Moderat" data-frequency="Høy"></td>
                <td class="red" data-consequence="Moderat" data-frequency="Svært høy"></td>
            </tr>
            <tr>
                <td class="highlight">Lav</td>
                <td class="green" data-consequence="Lav" data-frequency="Svært lav"></td>
                <td class="green" data-consequence="Lav" data-frequency="Lav"></td>
                <td class="yellow" data-consequence="Lav" data-frequency="Moderat"></td>
                <td class="yellow" data-consequence="Lav" data-frequency="Høy"></td>
                <td class="red" data-consequence="Lav" data-frequency="Svært høy"></td>
            </tr>
            <tr>
                <td class="highlight">Svært lav</td>
                <td class="green" data-consequence="Svært lav" data-frequency="Svært lav"></td>
                <td class="green" data-consequence="Svært lav" data-frequency="Lav"></td>
                <td class="green" data-consequence="Svært lav" data-frequency="Moderat"></td>
                <td class="yellow" data-consequence="Svært lav" data-frequency="Høy"></td>
                <td class="yellow" data-consequence="Svært lav" data-frequency="Svært høy"></td>
            </tr>
        </tbody>
    </table>

    <button onclick="loadRisks()">Last inn risikoer</button>


    <h3>Merk </h3>
<ul>
<li>På denne siden kan du kun laste inn data du har lagret </li>
<li>Hvis du bruker egendefinerte konsekvens- og hyppighetskalaer så må de lastes inn  </li>
<li>Risikomatrisen populeres ved å laste inn risikotabellen </li>
<li>Det er tre risikoverdier reprsentert ved rødt, gult og grønt </li>
</ul>

    

    <input type="file" id="riskInput" style="display:none" onchange="handleRisksFile(event)">
    <input type="file" id="consequenceInput" style="display:none" onchange="handleConsequencesFile(event)">
    <input type="file" id="frequencyInput" style="display:none" onchange="handleFrequenciesFile(event)">

    <script>
	'use strict';
        function loadRisks() {
            document.getElementById('riskInput').click();
        }

	function loadConsequences() {
            document.getElementById('consequenceInput').click();
        }

	function loadFrequencies() {
            document.getElementById('frequencyInput').click();
        }

        function handleRisksFile(event) {
            const rfile = event.target.files[0];
            const rreader = new FileReader();
            rreader.onload = function(e) {
                const data = JSON.parse(e.target.result);
                console.log('Loaded data:', data);
                populateMatrix(data);
            };
            rreader.readAsText(rfile);
        }

        function handleConsequencesFile(event) {
            const cfile = event.target.files[0];
            const creader = new FileReader();
            creader.onload = function(e) {
                const data = JSON.parse(e.target.result);
                console.log('Loaded data:', data);
                populateConsequenceTable(data);
            };
            creader.readAsText(cfile);
        }

        function handleFrequenciesFile(event) {
            const ffile = event.target.files[0];
            const freader = new FileReader();
            freader.onload = function(e) {
                const data = JSON.parse(e.target.result);
                console.log('Loaded data:', data);
                populateFrequencyTable(data);
            };
            freader.readAsText(ffile);
        }




function populateMatrix(data) {
    // Selects all rows starting from the third one, then selects all td elements excluding the first one in each row
    const matrixCells = document.querySelectorAll("#riskMatrix tr:nth-child(n+3) > td:not(:first-child)");

    matrixCells.forEach(cell => {
        cell.textContent = ''; // Clear existing text
    });


            data.forEach(row => {
                const consequence = row.konsekvens;
                const frequency = row.hyppighet;
                console.log(`Processing risk number ${row.risikonummer} with consequence ${consequence} and frequency ${frequency}`);
                const cell = document.querySelector(`td[data-consequence="${consequence}"][data-frequency="${frequency}"]`);
                if (cell) {
                    if (cell.textContent) {
                        cell.textContent += ', ';
                    }
                    cell.textContent += row.risikonummer;
                }
            });
        }

 // Function to load the second column from the json file for consequences

function loadConsequences() {
    const cinput = document.createElement("input");
    cinput.type = "file";
    cinput.accept = ".json";
    cinput.onchange = (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const savedData = JSON.parse(e.target.result);

                    if (savedData && savedData.length === 5) { // Ensure 5 rows are maintained
                        const rows = document.querySelectorAll("#consequenceScale tbody tr");
                        rows.forEach((row, index) => {
                            row.cells[1].textContent = savedData[index].beskrivelse || '';
                        });
                    } else {
                        alert("Filen må inneholde nøyaktig 5 rader.");
                    }
                } catch (error) {
                    alert("Kunne ikke lese filen. Kontroller at den er i riktig format.");
                }
            };
            reader.readAsText(file);
        }
    };
    document.body.appendChild(cinput);
    cinput.click();
    document.body.removeChild(cinput);
}

  
// Function to save the frequency scale in JSON format and download it as a file

function saveFrequencies() {
    // Get the table rows
    const frows = document.querySelectorAll("#frequencyScale tbody tr");

    // Array to hold the table data
    const frequencyData = [];


    // Iterate over each row
    frows.forEach((row) => {
       // Get the columns
       const fcolumns = row.querySelectorAll("td");
       // Save data
       frequencyData.push({
           verdi: fcolumns[0].textContent,
           beskrivelse: fcolumns[1].textContent
        });
    });


    // Convert the data to JSON format
    const jsonData = JSON.stringify(frequencyData, null, 2);

    // Ask the user for the file name
    const fileName = prompt("Navn på filen:", "hyppighetsskala.json");
    if (fileName) {
        // Create a blob from the JSON data
        const blob = new Blob([jsonData], { type: "application/json" });

        // Create a temporary link element
        const a = document.createElement("a");
        const url = URL.createObjectURL(blob);
        a.href = url;
        a.download = fileName;

        // Append the link to the body, click it, then remove it
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);

        // Revoke the object URL to free up memory
        URL.revokeObjectURL(url);
        
    }
}

// Function to load the second column from the json file for frequencies

function loadFrequencies() {
    // Create a file input element
    const finput = document.createElement("input");
    finput.type = "file";
    finput.accept = ".json";
    finput.onchange = (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const savedData = JSON.parse(e.target.result);

                    if (savedData && savedData.length === 5) { // Ensure 5 rows are maintained
                        const rows = document.querySelectorAll("#frequencyScale tbody tr");
                        rows.forEach((row, index) => {
                            row.cells[1].textContent = savedData[index].beskrivelse || '';
                        });
                    } else {
                        alert("Filen må inneholde nøyaktig 5 rader.");
                    }
                } catch (error) {
                    alert("Kunne ikke lese filen. Kontroller at den er i riktig format.");
                }
            };
            reader.readAsText(file);
        }
    };

    document.body.appendChild(finput);
    finput.click();
    document.body.removeChild(finput);
}






    </script>
</body>
</html>


